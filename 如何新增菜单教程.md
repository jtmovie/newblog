# 如何新增菜单和内容模块教程

本教程以添加"电影十三张"模块为例，教你如何在 Next.js 博客中新增菜单和对应的内容模块。

## 步骤概览

1. 更新导航配置
2. 创建内容目录和示例文章
3. 更新内容集合配置
4. 创建页面路由
5. 测试功能

---

## 步骤 1：更新导航配置

编辑 `src/lib/config.ts` 文件，在 `navigation.main` 数组中添加新的菜单项：

```typescript
navigation: {
  main: [
    {
      title: "文章",
      href: "/blog",
    },
    {
      title: "电影十三张",    // 菜单显示名称
      href: "/jtmovie"       // 对应的URL路径
    },
    // 在这里添加更多菜单项...
  ],
},
```

## 步骤 2：创建内容目录和示例文章

### 2.1 创建内容目录
```bash
mkdir -p src/content/jtmovie
```

### 2.2 创建示例文章
在 `src/content/jtmovie/` 目录下创建 Markdown 文件，例如 `example.md`：

```markdown
---
title: "文章标题"
date: "2024-03-15"
summary: "文章摘要"
keywords: ["关键词1", "关键词2", "关键词3"]
featured: true  # 可选，是否为精选文章
---

# 文章正文内容

这里写你的文章内容...

## 二级标题

内容...

### 三级标题

更多内容...
```

**frontmatter 字段说明：**
- `title`: 文章标题（必需）
- `date`: 发布日期（必需）
- `summary`: 文章摘要（可选）
- `keywords`: 关键词数组（可选）
- `featured`: 是否精选（可选，默认false）
- `updated`: 更新日期（可选）

## 步骤 3：更新内容集合配置

编辑 `content-collections.ts` 文件：

### 3.1 添加新的集合定义
```typescript
import { defineCollection, defineConfig } from "@content-collections/core";

// 现有的 blogs 集合...
const blogs = defineCollection({
  // ... 现有配置
});

// 添加新的集合
const jtmovies = defineCollection({
  name: "jtmovies",                    // 集合名称
  directory: "src/content/jtmovie",    // 内容目录
  include: "**/*.md",                  // 包含的文件类型
  schema: (z) => ({
    title: z.string(),
    date: z.string(),
    updated: z.string().optional(),
    featured: z.boolean().optional().default(false),
    summary: z.string().optional(),
    keywords: z.array(z.string()).optional(),
  }),
  transform: async (document) => {
    return {
      ...document,
      slug: `${document._meta.path}`,
    };
  },
});

// 3.2 导出配置，包含所有集合
export default defineConfig({
  collections: [blogs, jtmovies],  // 添加新集合到这里
});
```

## 步骤 4：创建页面路由

### 4.1 创建目录结构
```bash
mkdir -p "src/app/jtmovie/[...slug]"
```

### 4.2 创建列表页面
创建 `src/app/jtmovie/page.tsx`：

```typescript
import { type Metadata } from "next";
import { allJtmovies } from "content-collections";  // 导入对应的集合
import Link from "next/link";
import count from 'word-count'
import { config } from "@/lib/config";
import { formatDate } from "@/lib/utils";

export const metadata: Metadata = {
  title: `电影十三张 | ${config.site.title}`,
  description: `电影评论和思考 - ${config.site.title}`,
  keywords: `${config.site.title}, 电影, 电影评论, 电影十三张, 影评`,
};

export default function JtmoviePage() {
  // 按日期排序
  const movies = allJtmovies.sort((a: any, b: any) =>
    new Date(b.date).getTime() - new Date(a.date).getTime()
  );

  return (
    <div className="max-w-3xl mx-auto px-4 py-8">
      <div className="mb-8">
        <h1 className="text-3xl font-bold mb-4">电影十三张</h1>
        <p className="text-gray-600">记录电影中的光影时刻，分享观影心得和思考</p>
      </div>

      <div className="space-y-8">
        {movies.map((movie: any) => (
          <article key={movie.slug} className="">
            <Link href={`/jtmovie/${movie.slug}`}>
              <div className="flex flex-col space-y-2">
                <div className="flex items-center justify-between">
                  <h2 className="text-xl font-semibold underline underline-offset-4">
                    {movie.title}
                  </h2>
                  <span className="text-sm text-gray-500">
                    {formatDate(movie.date)} · {count(movie.content)} 字
                  </span>
                </div>
                <p className="text-gray-600 line-clamp-2">
                  {movie.summary}
                </p>
              </div>
            </Link>
          </article>
        ))}
      </div>
    </div>
  );
}
```

### 4.3 创建详情页面
创建 `src/app/jtmovie/[...slug]/page.tsx`：

```typescript
import { allJtmovies } from "content-collections"
import type { Metadata } from "next"
import { absoluteUrl, formatDate } from "@/lib/utils"
import { notFound } from "next/navigation"
import { getTableOfContents } from "@/lib/toc"
import { DashboardTableOfContents } from "@/components/toc"
import { MDXRemote } from 'next-mdx-remote-client/rsc'
import count from 'word-count'
import { components } from "@/components/mdx-components"
import remarkGfm from 'remark-gfm'
import remarkMath from 'remark-math'
import rehypeKatex from 'rehype-katex'
import rehypeHighlight from 'rehype-highlight';
import rehypeSlug from 'rehype-slug';
import 'highlight.js/styles/github-dark.min.css'
import GiscusComments from "@/components/giscus-comments"
import { GoToTop } from "@/components/go-to-top"
import 'katex/dist/katex.min.css';
import { config } from "@/lib/config";

type JtmoviePageProps = {
  params: Promise<{slug: string[]}>
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>
}

const options = {
  mdxOptions: {
      remarkPlugins: [remarkGfm, remarkMath],
      rehypePlugins: [rehypeKatex, rehypeHighlight, rehypeSlug],
  }
}

async function getJtmovieFromParams(slugs: string[]) {
  const slug = slugs?.join("/") || ""
  const movie = allJtmovies.find((movie: any) => movie.slug === slug)

  if (!movie) {
    return null
  }

  return movie
}

export async function generateMetadata({ params }: JtmoviePageProps): Promise<Metadata> {
  const { slug } = await params
  const movie = await getJtmovieFromParams(slug)

  if (!movie) {
    return {}
  }

  return {
    title: movie.title,
    description: movie.summary || movie.title,
    keywords: movie.keywords,
    openGraph: {
      title: movie.title,
      description: movie.summary || movie.title,
      type: config.seo.openGraph.type,
      url: absoluteUrl("/jtmovie/" + movie.slug),
      images: [{ url: config.site.image }],
    },
    twitter: {
      card: config.seo.twitter.card,
      title: movie.title,
      description: movie.summary || movie.title,
      images: [{ url: config.site.image }],
      creator: config.seo.twitter.creator,
    },
  }
}

export async function generateStaticParams(): Promise<string[]> {
  return allJtmovies.map((movie: any) => ({
    slug: movie.slug.split('/'),
  }))
}

export default async function JtmoviePage(props: JtmoviePageProps) {
  const { slug } = await props.params;
  const movie = await getJtmovieFromParams(slug)

  if (!movie) {
    notFound()
  }

  const toc = await getTableOfContents(movie.content)

  return (
    <main className="relative py-6 max-w-full md:max-w-6xl mx-auto lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
      <div className="max-w-4xl mx-auto w-full px-6">
        <div className="my-8">
          <h1 className="text-[32px] font-bold">{movie.title}</h1>
        </div>

        <div className="my-4">
          <p className="text-sm">
            {formatDate(movie.date)} · {count(movie.content)} 字
          </p>
        </div>

        <div className="">
          <MDXRemote source={movie.content} components={components} options={options} />
        </div>

        <GiscusComments />
      </div>
      <div className="hidden text-sm xl:block">
        <div className="sticky top-16 -mt-6 h-[calc(100vh-3.5rem)]">
          <div className="h-full overflow-auto pb-10 flex flex-col justify-between mt-16 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:'none'] [scrollbar-width:'none']">
            <DashboardTableOfContents toc={toc} />
            <GoToTop />
          </div>
        </div>
      </div>
    </main>
  );
}
```

## 步骤 5：测试功能

1. **启动开发服务器**：
   ```bash
   npm run dev
   ```

2. **访问页面测试**：
   - 列表页：`http://localhost:3000/jtmovie`
   - 文章页：`http://localhost:3000/jtmovie/文章文件名`

3. **检查功能**：
   - 导航菜单是否显示
   - 列表页是否正常显示文章列表
   - 文章详情页是否正常渲染
   - TOC目录是否生成
   - 评论系统是否正常

---

## 快速复制模板

### 新增其他模块（如"技术笔记"）

1. **更新配置**：
   ```typescript
   // src/lib/config.ts
   navigation: {
     main: [
       { title: "文章", href: "/blog" },
       { title: "电影十三张", href: "/jtmovie" },
       { title: "技术笔记", href: "/tech" },  // 新增
     ],
   },
   ```

2. **创建内容**：
   ```bash
   mkdir -p src/content/tech
   ```

3. **更新集合**：
   ```typescript
   // content-collections.ts
   const techs = defineCollection({
     name: "techs",
     directory: "src/content/tech",
     include: "**/*.md",
     schema: (z) => ({ /* 同样的schema */ }),
     transform: async (document) => ({ /* 同样的transform */ }),
   });

   export default defineConfig({
     collections: [blogs, jtmovies, techs],  // 添加 techs
   });
   ```

4. **创建页面**：
   ```bash
   mkdir -p "src/app/tech/[...slug]"
   ```

   然后复制 `jtmovie` 目录下的 `page.tsx` 文件，修改相应的变量名和导入即可。

---

## 注意事项

1. **文件命名**：URL 中的路径会自动根据文件名生成
2. **集合命名**：集合名需要是复数形式（如 `jtmovies`, `techs`）
3. **导入路径**：确保从 `content-collections` 正确导入对应的集合
4. **路由匹配**：目录名需要与配置中的 `href` 路径一致
5. **重启开发服务器**：修改配置文件后需要重启开发服务器

---

## 总结

通过以上 5 个步骤，你就可以轻松地在博客中添加新的内容模块了：

1. 配置导航菜单
2. 创建内容目录和文章
3. 更新内容集合配置
4. 创建对应的页面路由
5. 测试功能

每次新增模块只需要重复这些步骤，修改相应的名称和路径即可。